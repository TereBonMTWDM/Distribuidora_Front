<p-toast></p-toast>
<div class="row">
    <div class="col-md-12 ml-auto mr-auto">
        <div class="card" style="background-color: #d3f4ea;">
            <div class="card-header card-header-info text-center">
                <h2 class="card-title">Renovaciones</h2>
            </div>

            <!-- <div class="card-body">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-12 col-sm-12 d-flex justify-content-end ">
                            <button pButton pRipple (click)="AddAgente()" icon="pi pi-plus" pTooltip="Agregar agente"
                                tooltipPosition="left" class="p-button-sm p-button-success m-1"></button>
                        </div>
                    </div>
                </div>
            </div> -->

            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <p-table #dt [value]="renovaciones" editMode="row" [rows]="10" [paginator]="true"
                            [globalFilterFields]="['asegurado', 'numPoliza']" [rowHover]="true" dataKey="idCobranza"
                            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
                            [showCurrentPageReport]="true" styleClass="p-datatable-sm" responsiveLayout="stack"
                            [rowsPerPageOptions]="[5, 10, 20]">
                            <ng-template pTemplate="caption">
                                <div class="grid">
                                    <div class="col-6 lg:col-4 md:col-4 sm:flex-nowrap align-items-rigth">
                                        <span class="p-input-icon-left w-full">
                                            <i class="pi pi-search"></i>
                                            <input pInputText type="text" [(ngModel)]="searchValue"
                                                (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                                                placeholder="Buscar por Nombre de Asegurado o Número de Póliza..."
                                                class="w-full" />
                                        </span>
                                    </div>
                                    <div
                                        class="col-2 lg:col-4 md:col-4 sm:flex-nowrap align-items-rigth justify-content-end">
                                        <p-button label="" [outlined]="true" icon="pi pi-filter-slash"
                                            (onClick)="clear(dt)" pTooltip="Limpiar filtro" />
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <!-- ***Encabezados -->
                                <tr>
                                    <th></th>
                                    <th pSortableColumn="asegurado">Asegurado <p-sortIcon
                                            field="asegurado"></p-sortIcon>
                                    </th>
                                    <th>Teléfono</th>
                                    <th>Correo electrónico</th>
                                    <th>Póliza</th>
                                    <th pSortableColumn="fechaVencimiento">Vencimiento <p-sortIcon
                                            field="fechaVencimiento"></p-sortIcon>
                                    </th>
                                    <th>Prima Neta</th>
                                    <th>Prima Total</th>
                                    <th>Renovación</th>
                                    <th style="width:250px">Opciones</th>
                                </tr>

                            </ng-template>
                            <ng-template pTemplate="body" let-item let-editing="editing" let-ri="rowIndex">
                                <tr [ngClass]="{'disabled-row': isRowDisabled(item)}" [pEditableRow]="item" [pTooltip]="item.idCobranza">
                                    <td><p-checkbox [ngModel]="item.esRenovado" [binary]="true" inputId="binary"
                                            [disabled]="true" /></td>
                                    <td>{{ item.asegurado }}</td>
                                    <td>{{ item.telefono }}</td>
                                    <td>{{ item.correo }}</td>
                                    <td>{{ item.numPoliza }}</td>
                                    <td> <strong> {{ item.fechaVencimiento | date: 'dd/MM/yy'}}</strong></td>
                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <input pInputText type="number" [(ngModel)]="item.primaNeta">
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                <div *ngIf="item.esRenovado === true">
                                                    {{ item.primaNeta | currency:'MXN':'symbol':'1.2-2':'es-MX' }}
                                                </div>

                                                <div *ngIf="item.esRenovado === false">
                                                    <p-tag *ngIf="item.esRenovado === false" icon="pi pi-dollar"
                                                        value="---" severity="warning" />
                                                </div>
                                            </ng-template>
                                        </p-cellEditor>

                                    </td>
                                    <td>
                                        <p-cellEditor>
                                            <ng-template pTemplate="input">
                                                <input pInputText type="number" [(ngModel)]="item.primaTotal" pFocus>
                                            </ng-template>
                                            <ng-template pTemplate="output">
                                                <div *ngIf="item.esRenovado === true">
                                                    {{ item.primaTotal | currency:'MXN':'symbol':'1.2-2':'es-MX' }}
                                                </div>

                                                <div *ngIf="item.esRenovado === false">
                                                    <p-tag *ngIf="item.esRenovado === false" icon="pi pi-dollar"
                                                        value="---" severity="warning" />
                                                </div>
                                            </ng-template>
                                        </p-cellEditor>
                                    </td>
                                    <td>
                                        <div *ngIf="item.fechaRenovacion === null">
                                            <span style="color: rgb(222, 220, 220); text-align: center;">---</span>
                                        </div>
                                        <span style="color: blueviolet;">
                                            <strong>{{ item.fechaRenovacion | date: 'dd/MM/yy'}}</strong>
                                        </span>
                                    </td>
                                    <td style="width:250px">
                                        <div *ngIf="item.esRenovado === false && !editing">
                                            <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                                icon="pi pi-sync" (click)="onRowEditInit(item)" pTooltip="Renovar"
                                                class="p-button-rounded p-button-text"></button>
                                        </div>
                                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow
                                            icon="pi pi-check" (click)="onRowEditSave(item)"
                                            [disabled]="!item.primaNeta || !item.primaTotal"
                                            class="p-button-rounded p-button-text p-button-success mr-2">
                                        </button>

                                        <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow
                                            icon="pi pi-times" (click)="onRowEditCancel(item, ri)"
                                            class="p-button-rounded p-button-text p-button-danger"></button>
                                    </td>
                                </tr>
                            </ng-template>

                            <ng-template pTemplate="summary">
                                <div class="p-d-flex p-ai-center p-jc-between">
                                    En total hay {{renovaciones ? renovaciones.length : 0 }} registros.
                                </div>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>